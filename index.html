<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chương 5 – Ghép Liên Minh (6–8 thẻ, có đánh số + dẫn chứng)</title>
<style>
  :root{
    --bg:#020617; --panel:#0b1220; --border:#1f2937; --text:#e5e7eb; --muted:#94a3b8;
    --green:#22c55e; --blue:#3b82f6; --amber:#f59e0b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

  header{position:sticky;top:0;z-index:10;display:flex;gap:10px;align-items:center;flex-wrap:wrap;
    padding:12px 16px;border-bottom:1px solid var(--border);background:rgba(2,6,23,.85);backdrop-filter:blur(6px)}
  h1{font-size:16px;margin:0;font-weight:800}
  .ctrl{display:flex;gap:8px;align-items:center;margin-left:auto;flex-wrap:wrap}
  select,button{background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:10px;padding:8px 10px;font-weight:700}
  button.primary{background:linear-gradient(180deg,#2563eb,#1d4ed8);border-color:#1e40af}
  button.warn{background:linear-gradient(180deg,#f59e0b,#b45309);border-color:#92400e}
  button:disabled{opacity:.55;cursor:not-allowed}
  .timer{font-size:22px;font-weight:900;border:1px solid var(--border);background:var(--panel);border-radius:10px;padding:6px 10px;min-width:90px;text-align:center}

  main{max-width:1100px;margin:0 auto;padding:16px 16px 96px}

  /* Vùng mục tiêu – nổi bật ở giữa */
  .goal{display:grid;place-items:center;border:1px solid var(--border);border-radius:18px;padding:18px;margin-bottom:14px;
    background:radial-gradient(80% 120% at 50% -10%,rgba(59,130,246,.18),transparent 60%),
               linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));}
  .goal h2{margin:6px 0 4px 0;font-size:22px;text-align:center}
  .goal small{color:var(--muted);text-align:center}
  .goal .meta{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:6px;color:var(--muted)}

  /* Lưới thẻ */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:12px;margin-top:16px}
  .card{position:relative;border:1px solid var(--border);border-radius:16px;padding:18px 16px;min-height:74px;background:linear-gradient(180deg,#0e1628,#0a1220);
    display:flex;align-items:center;justify-content:center;text-align:center;font-weight:800;user-select:none}
  .card .badge{position:absolute;left:10px;top:10px;border:1px solid var(--border);background:#0a1220;border-radius:999px;min-width:28px;min-height:28px;
    display:grid;place-items:center;font-weight:900}
  .card.reveal.correct{outline:2px solid var(--green);box-shadow:0 0 0 3px rgba(34,197,94,.28) inset}
  .card.reveal.incorrect{opacity:.5;filter:grayscale(40%)}

  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:10px;color:var(--muted);font-size:13px}

  /* Bảng điểm */
  .score{margin-top:18px;border:1px solid var(--border);border-radius:16px;padding:12px;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01))}
  .teams{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .team{border:1px solid var(--border);border-radius:14px;padding:10px;background:var(--panel)}
  .team input{width:100%;background:var(--panel);border:1px solid #223;color:var(--text);padding:8px;border-radius:10px;font-weight:800;text-align:center;margin-bottom:8px}
  .team .pt{display:flex;align-items:center;justify-content:center;gap:8px}
  .team .pt .v{font-size:22px;font-weight:900;min-width:30px;text-align:center}

  /* Panel dẫn chứng */
  .evidence{margin-top:16px;border:1px solid var(--border);border-radius:16px;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01))}
  .evidence h3{margin:0 0 8px 0;font-size:16px}
  .evidence ol{margin:0;padding:0 0 0 18px}
  .evidence li{margin:8px 0}
  .evidence small{color:var(--muted)}
  .evidence a{color:#93c5fd;text-decoration:none}
  .evidence a:hover{text-decoration:underline}

  /* Nhãn nhỏ */
  label.small{font-size:12px;color:var(--muted);font-weight:600}
</style>
</head>
<body>
<header>
  <h1> Game “Ghép Liên Minh” </h1>
  <div class="ctrl">
    <label for="sel" class="small">Thời gian:</label>
    <select id="sel">
      <option value="15">15s</option>
      <option value="20" selected>20s</option>
      <option value="35">35s</option>
      <option value="60">60s</option>
    </select>
    <label for="visible" class="small">Số thẻ/vòng:</label>
    <select id="visible">
      <option value="6" selected>6</option>
      <option value="7">7</option>
      <option value="8">8</option>
    </select>
    <div id="timer" class="timer">00:30</div>
    <button id="start" class="primary">Bắt đầu vòng</button>
    <button id="reveal" class="warn" disabled>Hiện đáp án</button>
    <button id="next">Vòng tiếp</button>
  </div>
</header>

<main>
  <!-- Mục tiêu ở giữa -->
  <section class="goal">
    <div style="text-align:center">
      <div class="meta">Vòng <b id="roundNo">1</b>/<span id="roundTotal">0</span> • Đúng: <b id="limit">0</b> thẻ</div>
      <h2 id="goal">Mục tiêu sẽ hiển thị ở đây</h2>
      <small id="rule">Chỉ có 0 thẻ đúng. Các đội ghi ra giấy, hết giờ cùng giơ đáp án.</small>
    </div>
  </section>

  <!-- Lưới thẻ có đánh số 1..N đặt ở dưới mục tiêu -->
  <section id="grid" class="grid"></section>

  <div class="row">
    <button id="reshuffle">Đổi vị trí/thẻ nhiễu</button>
    <span>• Mỗi vòng: đáp án đúng cố định; các thẻ còn lại chọn ngẫu nhiên từ 12 thẻ gốc. • Thẻ sẽ đánh số từ 1 → N.</span>
  </div>

  <!-- Panel dẫn chứng tự mở khi bấm "Hiện đáp án" -->
  <section id="evidence" class="evidence" hidden>
    <h3>Dẫn chứng cho đáp án</h3>
    <ol id="ev-list"></ol>
  </section>

  <section class="score">
    <div class="row">Sau khi hiện đáp án, cộng điểm cho đội trả lời đúng.</div>
    <div class="teams" id="teams"></div>
  </section>
</main>

<script>
// 12 thẻ cố định
const FIXED_CARDS = [
  "Công nhân","Nông dân","Trí thức","Doanh nhân","Thanh niên","Phụ nữ",
  "Dân tộc thiểu số","Lực lượng vũ trang","Giáo viên","Bác sĩ","Công chức","Nghệ sĩ"
];

/*\
 * ROUNDS: thêm "sources" cho từng đáp án đúng.
 * Có thể là chuỗi hoặc mảng chuỗi. Nếu chuỗi bắt đầu bằng "http", UI sẽ tự tạo link.
 * 👉 Bạn chỉ cần thay nội dung trong mảng/chuỗi bằng nguồn thật của bạn.
 */
const ROUNDS = [
  { goal: "Phát triển công nghiệp công nghệ cao",
    correct: ["Công nhân","Trí thức","Doanh nhân","Thanh niên"], limit: 4,
    sources: {
      "Công nhân": ["( vai trò công nhân trong CN hoá – HĐH)"],
      "Trí thức": ["( kinh tế tri thức/đổi mới sáng tạo đóng góp của trí thức)"],
      "Doanh nhân": ["( doanh nghiệp công nghệ cao/đổi mới sáng tạo)"],
      "Thanh niên": ["( lực lượng trẻ, khởi nghiệp, STEM)"]
    }
  },
  { goal: "Xây dựng nông thôn mới",
    correct: ["Nông dân","Trí thức","Công nhân","Thanh niên"], limit: 4,
    sources: {
      "Nông dân": ["(vai trò nông dân trong nông thôn mới)"],
      "Trí thức": ["( chuyển giao KHKT/khuyến nông)"],
      "Công nhân": ["( chế biến nông sản, hạ tầng CN phụ trợ)"],
      "Thanh niên": ["( thanh niên tình nguyện/xây dựng cộng đồng)"]
    }
  },
  { goal: "Bảo vệ Tổ quốc và ổn định xã hội",
    correct: ["Lực lượng vũ trang","Công nhân","Nông dân","Thanh niên"], limit: 4,
    sources: {
      "Lực lượng vũ trang": ["( quốc phòng toàn dân)"],
      "Công nhân": ["( an ninh kinh tế, đảm bảo chuỗi cung ứng chiến lược)"],
      "Nông dân": ["(N thế trận lòng dân/khu vực nông thôn)"],
      "Thanh niên": ["( nghĩa vụ, lực lượng dự bị)"],
    }
  },
  { goal: "Hội nhập quốc tế, nâng cao năng lực cạnh tranh",
    correct: ["Doanh nhân","Trí thức","Công chức","Thanh niên"], limit: 4,
    sources: {
      "Doanh nhân": ["( xuất khẩu, FDI, đổi mới mô hình quản trị)"] ,
      "Trí thức": ["( R&D, tiêu chuẩn quốc tế)"] ,
      "Công chức": ["(cải cách thể chế, môi trường kinh doanh)"] ,
      "Thanh niên": ["(lực lượng trẻ, khởi nghiệp, STEM)"] ,
    }
  },
  { goal: "Phát triển kinh tế tri thức, kinh tế số",
    correct: ["Trí thức","Công nhân"], limit: 2,
    sources: {
      "Trí thức": ["( chuyển giao công nghệ, AI/ dữ liệu)"] ,
      "Công nhân": ["( kỹ năng số, tự động hoá trong sản xuất)"] ,
    }
  },
  { goal: "Giảm bất bình đẳng, củng cố khối đại đoàn kết",
    correct: ["Trí thức","Công nhân","Phụ nữ","Dân tộc thiểu số"], limit: 4,
    sources: {
      "Trí thức": ["(tư vấn chính sách xã hội)"] ,
      "Công nhân": ["( an sinh cho lao động/nhà ở công nhân)"] ,
      "Phụ nữ": ["( bình đẳng giới, chăm sóc SKSS)"] ,
      "Dân tộc thiểu số": ["(chính sách dân tộc/giảm nghèo bền vững)"] ,
    }
  },
  { goal: "Nâng cao chất lượng y tế cộng đồng",
    correct: ["Bác sĩ","Công chức"], limit: 2,
    sources: {
      "Bác sĩ": ["( hệ thống y tế cơ sở, tiêm chủng)"] ,
      "Công chức": ["( quản lý y tế, BHYT)"] ,
    }
  },
  { goal: "Đổi mới giáo dục và phát triển khoa học",
    correct: ["Giáo viên","Trí thức"], limit: 2,
    sources: {
      "Giáo viên": ["( chương trình GDPT, chuyển đổi số giáo dục)"] ,
      "Trí thức": ["( nghiên cứu khoa học, đại học)"] ,
    }
  },
  { goal: "Phát triển văn hóa và bản sắc dân tộc",
    correct: ["Nghệ sĩ","Dân tộc thiểu số"], limit: 2,
    sources: {
      "Nghệ sĩ": ["( phát triển công nghiệp văn hoá)"] ,
      "Dân tộc thiểu số": ["( bảo tồn di sản, đa dạng văn hoá)"] ,
    }
  },
  { goal: "Phát triển doanh nghiệp đổi mới sáng tạo",
    correct: ["Doanh nhân","Trí thức","Công nhân","Công chức"], limit: 4,
    sources: {
      "Doanh nhân": ["(hệ sinh thái khởi nghiệp, quỹ đầu tư)"] ,
      "Trí thức": ["( sở hữu trí tuệ, phòng thí nghiệm)"] ,
      "Công nhân": ["( năng suất lao động, kỹ năng)"] ,
      "Công chức": ["(chính sách hỗ trợ DN đổi mới)"] ,
    }
  }
];

// State
let roundIdx = 0;
let secs = 30;
let t = null;
let randSeed = 0;

// Elements
const sel = document.getElementById('sel');
const visibleSel = document.getElementById('visible');
const timerEl = document.getElementById('timer');
const startBtn = document.getElementById('start');
const revealBtn = document.getElementById('reveal');
const nextBtn = document.getElementById('next');
const reshuffleBtn = document.getElementById('reshuffle');
const goalEl = document.getElementById('goal');
const ruleEl = document.getElementById('rule');
const limitEl = document.getElementById('limit');
const grid = document.getElementById('grid');
const roundNo = document.getElementById('roundNo');
const roundTotal = document.getElementById('roundTotal');
const evidenceEl = document.getElementById('evidence');
const evList = document.getElementById('ev-list');
roundTotal.textContent = ROUNDS.length.toString();

function fmt(s){const m=Math.floor(s/60);const ss=s%60;return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0');}
function stopTimer(){ if(t) { clearTimeout(t); t=null; } }
function tick(){ if(secs<=0){ stopTimer(); revealBtn.disabled=false; return;} secs--; timerEl.textContent=fmt(secs); t=setTimeout(tick,1000);} 
function startTimer(){ stopTimer(); secs=parseInt(sel.value,10)||30; timerEl.textContent=fmt(secs); revealBtn.disabled=true; tick(); }

function rng(max){ return Math.floor((Math.random()*100000 + randSeed) % max); }
function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=rng(i+1); [a[i],a[j]]=[a[j],a[i]]; } return a; }

// tạo N thẻ (N = 6..8): luôn chứa toàn bộ đáp án đúng + thẻ nhiễu cho đủ N, rồi xáo thứ tự
function buildCards(){
  const round = ROUNDS[roundIdx];
  const N = parseInt(visibleSel.value,10); // 6..8
  const correctSet = new Set(round.correct);

  // Pool thẻ nhiễu có thể chọn (loại bỏ các thẻ đúng của vòng)
  const pool = FIXED_CARDS.filter(c=>!correctSet.has(c));
  const need = Math.max(0, N - round.correct.length);
  const distractors = shuffle(pool).slice(0, need);
  const merged = shuffle([...round.correct, ...distractors]).slice(0, N);

  grid.innerHTML='';
  merged.forEach((label, idx)=>{
    const d=document.createElement('div');
    d.className='card';
    d.dataset.label = label; // lưu nhãn gốc để so khớp
    d.innerHTML = `<div class="badge">${idx+1}</div><div class="lab">${label}</div>`;
    grid.appendChild(d);
  });
}

function renderRound(){
  const round = ROUNDS[roundIdx];
  roundNo.textContent = (roundIdx+1).toString();
  goalEl.textContent = round.goal;
  limitEl.textContent = round.limit.toString();
  ruleEl.innerHTML = `Chỉ có <b>${round.limit}</b> thẻ đúng. Các đội ghi ra giấy, hết giờ cùng giơ đáp án.`;
  revealBtn.disabled = true; stopTimer(); timerEl.textContent = fmt(parseInt(sel.value,10)||30);
  evidenceEl.hidden = true; evList.innerHTML = '';
  buildCards();
}

function normalizeSources(src){
  if(!src) return [];
  if(Array.isArray(src)) return src;
  return [src];
}
function linkify(text){
  if(/^https?:\/\//i.test(text)){
    const url = text;
    return `<a href="${url}" target="_blank" rel="noopener">${url}</a>`;
  }
  return text;
}

function buildEvidence(){
  const round = ROUNDS[roundIdx];
  const cards = Array.from(grid.children);
  // Lập danh sách đúng và gắn số thẻ hiện tại
  const items = round.correct.map(lbl=>{
    const idx = cards.findIndex(c=>c.dataset.label===lbl);
    const num = idx>=0? idx+1 : null;
    const srcs = normalizeSources(round.sources && round.sources[lbl]);
    return {label: lbl, idx, num, srcs};
  }).sort((a,b)=> (a.idx - b.idx));

  evList.innerHTML = '';
  items.forEach(it=>{
    const li = document.createElement('li');
    const n = (it.num!=null? it.num+') ' : '');
    const srcHtml = it.srcs.length ? it.srcs.map(s=>'• '+linkify(s)).join('<br>') : '<em>Chưa thêm nguồn</em>';
    li.innerHTML = `<b>${n}${it.label}</b><br><small>${srcHtml}</small>`;
    evList.appendChild(li);
  });

  evidenceEl.hidden = false;
}

function reveal(){
  const round = ROUNDS[roundIdx];
  const correct = new Set(round.correct);
  Array.from(grid.children).forEach(card=>{
    const el = card; const label = el.dataset.label;
    el.classList.add('reveal', correct.has(label) ? 'correct' : 'incorrect');
  });
  buildEvidence(); // tự mở panel dẫn chứng
}

startBtn.addEventListener('click', ()=>{ randSeed++; startTimer(); buildCards(); evidenceEl.hidden=true; });
revealBtn.addEventListener('click', ()=>{ stopTimer(); reveal(); });
nextBtn.addEventListener('click', ()=>{ roundIdx=(roundIdx+1)%ROUNDS.length; renderRound(); });
reshuffleBtn.addEventListener('click', ()=>{ randSeed++; buildCards(); evidenceEl.hidden=true; });
visibleSel.addEventListener('change', ()=>{ buildCards(); evidenceEl.hidden=true; });

// init
renderRound();

// bảng điểm 2 đội (giữ nguyên, có thể đổi số đội nếu cần)
(function makeTeams(){
  const wrap = document.getElementById('teams');
  for(let i=0;i<2;i++){
    const box=document.createElement('div');
    box.className='team';
    box.innerHTML=`
      <input value="Đội ${i+1}" />
      <div class="pt">
        <button data-act="dec" data-i="${i}">−</button>
        <div class="v" id="sc-${i}">0</div>
        <button data-act="inc" data-i="${i}">＋</button>
      </div>`;
    wrap.appendChild(box);
  }
  wrap.addEventListener('click',(e)=>{
    const btn=e.target; if(!(btn instanceof HTMLElement) || btn.tagName!=='BUTTON') return;
    const i=parseInt(btn.getAttribute('data-i'),10); const act=btn.getAttribute('data-act');
    const numEl=document.getElementById('sc-'+i); const val=parseInt(numEl.textContent||'0',10);
    numEl.textContent=String(Math.max(0, val + (act==='inc'?1:-1)));
  });
})();
</script>
</body>
</html>
